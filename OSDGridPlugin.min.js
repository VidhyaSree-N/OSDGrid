class GridViewerPlugin{viewer;overlay;fabricCanvas;useBuiltInUI;conversionFactor;menuOptions;units;constructor(n,i={}){this.viewer=n,this.processOptions(i),this.overlay=n.fabricjsOverlay(),this.fabricCanvas=this.overlay.fabricCanvas(),this.gridGroup=new fabric.Group([],{selectable:!1,evented:!1}),this.toggleGrid=this.toggleGrid.bind(this),this.rotateGrid=this.rotateGrid.bind(this),this.changeGridSize=this.changeGridSize.bind(this),this.addPluginHTML(n),this.addPluginCSS(n),this.addGrid()}processOptions(n){n.conversionFactor?this.conversionFactor=n.conversionFactor:this.conversionFactor=1,n.units?this.units=n.units:this.units="px"}toggleGrid(){var n=this.gridGroup.visible;this.gridGroup.visible=!n,this.fabricCanvas.renderAll();var i=document.getElementById("grid-rotation-slider"),e=document.getElementById("grid"),t=document.getElementById("angle-display"),r=document.getElementById("grid-rotation-label"),s=document.getElementById("grid-size-label"),d=document.getElementById("grid-size-slider"),l=document.getElementById("grid-size-value");n?(i.style.display="none",t.style.display="none",r.style.display="none",s.style.display="none",d.style.display="none",l.style.display="none",e.checked=!1):(s.style.display="block",d.style.display="block",i.style.display="block",t.style.display="block",r.style.display="block",l.style.display="block",e.checked=!0,r.innerText="Grid Rotation:",s.innerText="Grid Size:")}changeGridSize(){const n=document.getElementById("grid-size-slider"),i=document.getElementById("grid-size-value"),e=parseInt(n.value),t=(e*this.conversionFactor).toFixed(3);i.innerText=t+this.units,this.gridGroup.remove(...this.gridGroup.getObjects("line"));var r=this.viewer.world;if(r){for(var s=r.getItemAt(0).getContentSize(),d=s.x,l=s.y,o=Math.sqrt(d**2+l**2),a=-o;a<=o;a+=e){var c=new fabric.Line([-o,a,o,a],{stroke:"grey",strokeWidth:5});this.gridGroup.add(c)}for(a=-o;a<=o;a+=e){c=new fabric.Line([a,-o,a,o],{stroke:"grey",strokeWidth:5});this.gridGroup.add(c)}this.gridGroup.clipTo=function(n){n.rect(0,0,d,l)},this.fabricCanvas.renderAll()}}rotateGrid(){var n=document.getElementById("grid-rotation-slider").value;this.gridGroup.setAngle(n),document.getElementById("angle-display").innerText=n,this.fabricCanvas.renderAll()}addPluginHTML(n){document.getElementById(n.element.id).insertAdjacentHTML("beforeend",'\n    <div id="info">\n        <span>Grid</span>\n        <label class="switch" for="grid">\n            <input type="checkbox" id="grid">\n            <span class="slider round"></span>\n        </label>\n        <p id="grid-rotation-label"></p>\n        <div class="slider-container">\n            <input type="range" min="-180" max="180" value="0" id="grid-rotation-slider" class="slider-input">\n            <p id="angle-display" class="slider-value"></p>\n        </div>\n        <p id="grid-size-label"></p>\n        <div class="slider-container">\n            <input type="range" min="100" max="5000" value="440" id="grid-size-slider" class="slider-input">\n            <p id="grid-size-value" class="slider-value" style="display:none"></p>\n        </div>\n    </div>\n  ')}addPluginCSS(n){const i=document.createElement("style");i.innerHTML='\n    .switch {\n        position: relative;\n        display: inline-block;\n        width: 50px;\n        height: 24px;\n        }\n\n        .switch input {\n        opacity: 0;\n        width: 0;\n        height: 0;\n        }\n\n        .slider {\n        position: absolute;\n        cursor: pointer;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: #ccc;\n        -webkit-transition: .4s;\n        transition: .4s;\n        }\n\n        .slider:before {\n        position: absolute;\n        content: "";\n        height: 18px;\n        width: 18px;\n        left: 3px;\n        bottom: 3px;\n        background-color: white;\n        -webkit-transition: .4s;\n        transition: .4s;\n        }\n\n        input:checked + .slider {\n        background-color: #2196F3;\n        }\n\n        input:focus + .slider {\n        box-shadow: 0 0 1px #2196F3;\n        }\n\n        input:checked + .slider:before {\n        -webkit-transform: translateX(26px);\n        -ms-transform: translateX(26px);\n        transform: translateX(26px);\n        }\n\n        .slider-container {\n        display: flex;\n        align-items: center;\n        }\n\n        .slider-input {\n        width: 100px;\n        margin-right: 10px;\n        }\n\n        .slider-value {\n        margin: 0;\n        }\n\n        /* Rounded sliders */\n        .slider.round {\n        border-radius: 34px;\n        }\n\n        .slider.round:before {\n        border-radius: 50%;\n        }\n\n        #grid-rotation {\n        display: none;\n        }\n\n        #grid-rotation.visible {\n        display: inline-block;\n        }\n\n        #grid-rotation-container {\n          display: none;\n          margin-left: 10px;\n        }\n\n        #grid-rotation-slider.visible {\n          display: inline-block;\n        }\n\n        #grid-rotation-label {\n          display: inline-block;\n          text-align: left;\n          margin-left: 5px;\n        }\n\n        #grid-rotation-slider.visible + #grid-rotation-label {\n          display: inline-block;\n        }\n\n        #grid-rotation-slider {\n          display: none;\n        }\n\n\n        #grid-size {\n        display: none;\n        }\n\n        #grid-size.visible {\n        display: inline-block;\n        }\n\n        #grid-size-container {\n          display: none;\n          margin-left: 10px;\n        }\n\n        #grid-size-slider.visible {\n          display: inline-block;\n        }\n\n        #grid-size-label {\n         display: inline-block;\n          text-align: left;\n          margin-left: 5px;\n        }\n\n        #grid-size-slider.visible + #grid-size-label {\n          display: inline-block;\n        }\n\n        #grid-size-slider {\n          display: none;\n        }\n\n        #info {\n          position: absolute;\n          z-index: 1000;\n          bottom: 0;\n          left: 0;\n          padding: 10px;\n          background-color: rgba(0, 0, 0, 0.7);\n          min-height: 5vh;\n          width: 12vw;\n          color: white;\n          font-family: sans-serif;\n          font-size: 0.9em;\n          }\n  ';document.getElementById(n.element.id).appendChild(i)}addGrid(){(()=>{this.viewer.addHandler("open",(()=>{var n=.1/this.conversionFactor,i=this.viewer.world;if(i){for(var e=i.getItemAt(0).getContentSize(),t=e.x,r=e.y,s=0;s<=r;s+=n){var d=new fabric.Line([0,s,t,s],{stroke:"grey",strokeWidth:5});this.gridGroup.add(d)}for(s=0;s<=t;s+=n){d=new fabric.Line([s,0,s,r],{stroke:"grey",strokeWidth:5});this.gridGroup.add(d)}this.fabricCanvas.add(this.gridGroup),this.gridGroup.visible=!1,this.changeGridSize()}})),document.getElementById("grid-rotation-slider").addEventListener("input",this.rotateGrid),document.getElementById("grid").addEventListener("change",this.toggleGrid),document.getElementById("grid-size-slider").addEventListener("input",this.changeGridSize)})()}}